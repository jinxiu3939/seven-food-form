<div class="dynamic-form">
  <form *ngIf="form"
        [formGroup]="form"
        [nbSpinner]="loading"
        nbSpinnerStatus="info"
        (ngSubmit)="onSubmit()">
    <ng-container *ngIf="complete">
      <ng-container [ngSwitch]="layout">
        <nb-tabset *ngSwitchCase="'tab'">
          <nb-tab *ngFor="let block of models; let i = index" [tabTitle]="block.title" [lazyLoad]="true" badgeStatus="danger" [badgeText]="isBlockInvalid(i)">
            <ngx-form-block *ngIf="block.items"
                            [models]="block.items"
                            [column]="block.column"
                            [form]="form"
                            [size]="block.size"
                            [reload]="reload"></ngx-form-block>
          </nb-tab>
        </nb-tabset>
        <nb-stepper *ngSwitchCase="'step'" orientation="horizontal">
          <nb-step *ngFor="let block of models" [label]="block.title">
            <ngx-form-block *ngIf="block.items"
                            [models]="block.items"
                            [column]="block.column"
                            [form]="form"
                            [size]="block.size"
                            [reload]="reload"></ngx-form-block>
          </nb-step>
        </nb-stepper>
        <ul *ngSwitchDefault class="default-block" [ngClass]="{'fold-block': !formExpand, 'custom-condition': layout==='custom'}">
          <li *ngFor="let block of models; let i = index">
            <h3 *ngIf="block.title">
              {{ block.title }}
              <nb-badge *ngIf="isBlockInvalid(i) > 0"
                position="right"
                status="danger"
                [text]="blockInValid[i]">
              </nb-badge>
              <nb-icon [icon]="block.hide ? 'arrow-ios-downward' : 'arrow-ios-upward'" status="info" (click)="foldBlock(i)"></nb-icon>
            </h3>
            <ngx-form-block *ngIf="block.items"
                            [models]="block.items"
                            [column]="block.column"
                            [hide]="block.hide"
                            [form]="form"
                            [reload]="reload"
                            [size]="block.size">
            </ngx-form-block>
          </li>
        </ul>
      </ng-container>
    </ng-container>
    <ng-content select="[name='other-models']"></ng-content>
    <div class="form-group form-operation" [ngClass]="{'custom-operation': layout==='custom'}">
      <button *ngIf="submit" type="submit" class="btn btn-success" [disabled]="validate && !form.valid">{{ submitText }}</button>
      <button *ngIf="reset" type="button" class="btn btn-warning" (click)="onReset()">{{ resetText }}</button>
      <ng-container *ngIf="buttons">
        <button *ngFor="let btn of buttons" type="button" class="btn btn-primary" (click)="onOperate(btn)">
          {{ btn.value }}
        </button>
      </ng-container>
      <nb-icon *ngIf="fold" [icon]="formFoldIcon" status="info" (click)="foldForm()"></nb-icon>
    </div>
  </form>
</div>