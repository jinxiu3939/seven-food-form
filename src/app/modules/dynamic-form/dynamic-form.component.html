<div class="dynamic-form">
  <form *ngIf="form"
        [formGroup]="form"
        [nbSpinner]="loading"
        nbSpinnerStatus="info"
        (ngSubmit)="onSubmit()">
    <ng-container *ngIf="complete">
      <nb-tabset *ngIf="tabLayout.length > 0" class="top-layout">
        <nb-tab *ngFor="let children of tabLayout; let i = index"
                [lazyLoad]="true"
                [tabTitle]="children.title"
                badgeStatus="danger"
                [badgeText]="isBlockInvalid(i)">
          <ngx-form-layout [groups]="children.components"
                           [form]="form"
                           [layout]="layout"
                           [reload]="reload"
                           [ngClass]="{'fold-block': !formExpand}"></ngx-form-layout>
        </nb-tab>
      </nb-tabset>
      <ngx-form-layout *ngIf="tabLayout.length === 0"
                       [groups]="models"
                       [form]="form"
                       [layout]="layout"
                       [reload]="reload"
                       [ngClass]="{'fold-block': !formExpand}"></ngx-form-layout>
    </ng-container>
    <ng-content select="[name='other-models']"></ng-content>
    <div class="form-group form-operation" [ngClass]="{'custom-operation': layout==='custom'}">
      <button *ngIf="submit" type="submit" class="btn btn-success" [disabled]="validate && !form.valid">{{ submitText }}</button>
      <button *ngIf="reset" type="button" class="btn btn-warning" (click)="onReset()">{{ resetText }}</button>
      <ng-container *ngIf="buttons">
        <button *ngFor="let btn of buttons" type="button" class="btn btn-primary" (click)="onOperate(btn)">
          {{ btn.value }}
        </button>
      </ng-container>
      <nb-icon *ngIf="fold" [icon]="formFoldIcon" status="info" (click)="foldForm()"></nb-icon>
    </div>
  </form>
</div>